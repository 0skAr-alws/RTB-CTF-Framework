{% extends "layout.html" %}
{% from "forms.html" import user_hash_form_macro, root_hash_form_macro %}

{% block content %}

{% if current_user.isAdmin %}
    <a href="{{ url_for('ctf.new_machine') }}" class="ml-2 red-underlined-link">Add new</a>
{% endif %}

{% for box in boxes %}

<div class="accordion" id="machine-{{ loop.index }}">

  <div class="content-section">
    <!-- Bar -->
    <i class="mr-2 fab fa-{{ box['os'] }}"></i>
    <a class="red-link" data-toggle="collapse" 
            data-target="#m-collapse-{{ loop.index }}" 
            aria-controls="m-collapse-{{ loop.index }}">
      {{ box['name'] }}
    </a>
    <span class="ml-2">
      <small>
        {{ box['ip'] }}
      </small>
    </span>
    <span class="float-right">
      <a class="btn-sm btn-dark btn-hover-red" 
         data-toggle="modal"
         href="#m-form"
         data-boxId="{{ box['id'] }}">
          <i class="far fa-flag"
             data-toggle="tooltip"
             title="submit flags">
          </i>
      </a>
      <a class="ml-1 btn-sm btn-dark btn-hover-red"
         data-toggle="tooltip" 
         title="rate machine (coming soon)">
        <i class="far fa-star"></i>
      </a>
    </span>
    <!-- !Bar -->
  <div id="m-collapse-{{ loop.index }}" class="collapse" data-parent="#machine-{{ loop.index }}">

      <!-- Machine Card -->
      <div class="mt-3 content-section">
  
        <div class="machine-heading">{{ box['name'] }}</div>
        <hr/>
        <div class="row">
          <div class="col-sm-3">
              <div class="card">
                <div class="card-header">IP</div>  
                <h5 class="card-title">{{ box['ip'] }}</h5>
              </div>
          </div>
          <div class="col-sm-3">
              <div class="card">
                <div class="card-header">OS</div>   
                <h5 class="card-title text-capitalize">{{ box['os'] }}</h5>
              </div>
          </div>
          <div class="col-sm-3">
              <div class="card">
                <div class="card-header">Points</div> 
                  <h6 class="card-text">User: {{ box['user_points'] }} <br/> Root: {{ box['root_points'] }}</h6>
              </div>
          </div> 
          <div class="col-sm-3">
              <div class="card">
                <div class="card-header">Difficulty</div>   
                <h5 class="card-title text-capitalize">{{ box['hardness'] }}</h5>
              </div>
          </div>
        </div>
        
      </div>
      <!-- !Machine Card -->

  </div>
  </div>

</div>

{% endfor %}

<!-- Flag Submission Forms Modal -->
<div class="modal fade" id="m-form" tabindex="-1" role="dialog" aria-labelledby="m-form" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="content-section modal-content">
        <h4 class="title-heading border-bottom">Submit Flags</h4>
        <div class="modal-body mx-0 px-0">
          {% if past_running_time %}
            The CTF has ended. <a class="red-underlined-link" href="{{ url_for('ctf.scoreboard') }}">Scoreboard</a>.
          {% else %}
          <!-- User Hash Form -->
              {{ user_hash_form_macro(form=userHashForm) }}
              <br/>
          <!-- Root Hash Form -->
              {{ root_hash_form_macro(form=rootHashForm) }}
          {% endif %}
        </div>
      <div class="justify-content-start px-0 modal-footer">
        <button type="button" class="m-0 btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


{% endblock content %}



